version: 2

models:
  ### FACT_INVENTORY ###
  - name: fact_inventory
    contract:
      enforced: true
    latest_version: 1
    columns:
      - name: inventory_transactions_id
        data_type: number
        description: "Unique ID"
        constraint:
          - type: primary_key
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: purchase_order_id
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__purchase_order')
              field: purchase_order_id
      - name: product_id
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__products')
              field: product_id
      - name: inventory_quantity
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: type_name
        data_type: varchar
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_set:
              value_set: ["Sold", "Purchased", "On Hold"]
      - name: transaction_created_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: transaction_modified_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: comments
        data_type: varchar
      - name: customer_order_id
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: inventory_purchase_order_id
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: product_name
        data_type: varchar
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: supplier_company
        data_type: varchar
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: supplier_first_name
        data_type: varchar
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: supplier_last_name
        data_type: varchar
        tests:
          - dbt_expectations.expect_column_to_exist
    versions:
      - v: 1

  ### FACT_PURCHASE_ORDER ###
  - name: fact_purchase_order
    contract:
      enforced: true
    description: "fact_purchase_order for customer reporting"
    latest_version: 1
    columns:
      - name: unique_key
        data_type: varchar
        description: "Surrogate key generated by customer_id,purchase_order_id,order_id,product_id"
        constraint:
          - type: primary_key
        tests:
          - not_null
          - unique
      - name: purchase_order_id
        data_type: number
        tests:
          - not_null
      - name: approved_by
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id
      - name: submitted_by
        data_type: number
      - name: approved_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: submitted_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
          - not_null
      - name: creation_date
        data_type: date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: customer_id
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__customer')
              field: customer_id
      - name: employee_id
        data_type: number
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id
      - name: payment_amount
        data_type: float
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [float, number, decimal]
      - name: quantity
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number
      - name: product_id
        data_type: number
      - name: unit_cost
        data_type: number
      - name: date_received
        data_type: timestamp_ntz
      - name: posted_to_inventory
        data_type: number
      - name: inventory_id
        data_type: number
      - name: supplier_id
        data_type: number
      - name: created_by
        data_type: number
      - name: status_id
        data_type: number
      - name: expected_date
        data_type: date
      - name: shipping_fee
        data_type: float
      - name: taxes
        data_type: float
      - name: payment_date
        data_type: timestamp_ntz
      - name: payment_method
        data_type: varchar
      - name: submitted_date
        data_type: date
      - name: ingestion_timestamp
        data_type: timestamp_ntz
    versions:
      - v: 1
  ### FACT_SALES ###
  - name: fact_sales
    contract:
      enforced: true
    latest_version: 1
    columns:
      - name: sales_unique_key
        data_type: varchar
        description: "Surrogate key is generated from order_id,product-id,customer_id,employee_id,quantity"
        constraint:
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: customer_id
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_not_be_null
          - relationships:
              to: ref('northwind_stg__customer')
              field: customer_id
      - name: discount
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: employee_id
        data_type: number
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id

      - name: order_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: order_id
        data_type: number
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__orders')
              field: order_id
      - name: paid_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: product_id
        data_type: number
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist

      - name: quantity
        data_type: number
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number
      - name: shipped_date
        data_type: timestamp_ntz
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: status_id
        data_type: number
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: date_allocated
        data_type: timestamp_ntz
      - name: product_name
        data_type: varchar
      - name: unit_price
        data_type: float
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [number, float]
    versions:
      - v: 1
