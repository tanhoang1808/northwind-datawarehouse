version: 2

models:
  ### FACT_INVENTORY ###
  - name: fact_inventory
    columns:
      - name: inventory_transactions_id
        constraint:
          - type: primary_key
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: purchase_order_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__purchase_order')
              field: purchase_order_id
      - name: product_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__products')
              field: product_id
      - name: quantity
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_not_be_null
      - name: type_name
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_set:
              value_set: ["Sold", "Purchased", "On Hold"]
      - name: transaction_created_date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: transaction_modified_date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]

  ### FACT_PURCHASE_ORDER ###
  - name: fact_purchase_order
    description: "fact_purchase_order"
    columns:
      - name: unique_key
        constraint:
          - type: primary_key
        tests:
          - not_null
          - unique
      - name: purchase_order_id
        tests:
          - not_null
      - name: approved_by
        constraint:
          - type: foreign_key
        tests:
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id
      - name: approved_date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: submitted_date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
          - not_null
      - name: creation_date
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: customer_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__customer')
              field: customer_id
      - name: employee_id
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id
      - name: payment_amount
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [float, number, decimal]
      - name: quantity
        tests:
          - dbt_expectations.expect_column_to_exist
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

  ### FACT_SALES ###
  - name: fact_sales
    columns:
      - name: customer_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_not_be_null
          - relationships:
              to: ref('northwind_stg__customer')
              field: customer_id
      - name: discount
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: employee_id
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__employees')
              field: employee_id
      - name: inventory_id
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: order_date
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [date, datetime, timestamp, timestamp_ntz]
      - name: order_id
        constraint:
          -type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__orders')
              field: order_id
      - name: paid_date
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: product_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
      - name: purchase_order_id
        constraint:
          - type: foreign_key
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - relationships:
              to: ref('northwind_stg__purchase_order')
              field: purchase_order_id
      - name: quantity
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number
      - name: shipped_date
        tests:
          - dbt_expectations.expect_column_to_exist
      - name: status_id
        tests:
          - dbt_expectations.expect_column_to_exist

      - name: unit_price
        tests:
          - dbt_expectations.expect_column_values_to_not_be_null
          - dbt_expectations.expect_column_to_exist
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list: [number, float]
